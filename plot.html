import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const ThalassaraSimulator = () => {
  const [hydrothermalActivity, setHydrothermalActivity] = useState(50);
  const [chemosynthesisBacteria, setChemosynthesisBacteria] = useState(1000);
  const [predators, setPredators] = useState(100);
  const [time, setTime] = useState(0);
  const [data, setData] = useState([]);

  useEffect(() => {
    const interval = setInterval(() => {
      updateEcosystem();
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  const updateEcosystem = () => {
    setTime(prevTime => {
      const newTime = prevTime + 1;

      // Update bacteria count using the previous state
      setChemosynthesisBacteria(prevBacteria => {
        const newBacteria = prevBacteria + 
          (hydrothermalActivity / 10) * (Math.random() * 20 - 10) - 
          (predators * 0.5);
        return Math.max(0, Math.round(newBacteria));
      });

      // Update predator count using the previous state
      setPredators(prevPredators => {
        const newPredators = prevPredators + 
          (chemosynthesisBacteria / 1000) * (Math.random() * 2 - 1) - 
          (prevPredators * 0.1);
        return Math.max(0, Math.round(newPredators));
      });

      // Log the updated ecosystem data
      setData(prevData => [
        ...prevData,
        {
          time: newTime,
          bacteria: chemosynthesisBacteria,
          predators: predators
        }
      ].slice(-20));

      return newTime; // Ensure we return the new time for the next iteration
    });
  };

  return (
    <div className="p-4 bg-gray-800 rounded-lg shadow-xl">
      <h2 className="text-2xl font-bold mb-4 text-blue-300">Thalassara Ecosystem Simulator</h2>
      
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-300 mb-2">
          Hydrothermal Activity: {hydrothermalActivity}%
        </label>
        <input
          type="range"
          min="0"
          max="100"
          value={hydrothermalActivity}
          onChange={(e) => setHydrothermalActivity(Number(e.target.value))}
          className="w-full accent-green-400"
        />
      </div>

      <div className="grid grid-cols-2 gap-4 mb-4">
        <div className="bg-gray-700 p-4 rounded">
          <h3 className="text-lg font-semibold mb-2 text-blue-200">Chemosynthesis Bacteria</h3>
          <p className="text-2xl font-bold text-green-400">{chemosynthesisBacteria.toLocaleString()}</p>
        </div>
        <div className="bg-gray-700 p-4 rounded">
          <h3 className="text-lg font-semibold mb-2 text-blue-200">Predators</h3>
          <p className="text-2xl font-bold text-red-400">{predators.toLocaleString()}</p>
        </div>
      </div>

      <ResponsiveContainer width="100%" height={300}>
        <LineChart data={data}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="time" />
          <YAxis />
          <Tooltip />
          <Legend />
          <Line type="monotone" dataKey="bacteria" stroke="#4ade80" name="Bacteria" />
          <Line type="monotone" dataKey="predators" stroke="#f87171" name="Predators" />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
};

export default ThalassaraSimulator;
